function init(){$("#loading-bar").toggleClass("action"),$.ajax({url:"api.php",cache:!1,dataType:"json",type:"GET",data:{calling:"log",action:"history_log",device_id:device_id,time_stamp:time_lastupdate,limit:limit},error:function(){$("#disconnect-bar").addClass("active"),setTimeout(function(){myChart.destroy(),init()},1e4)}}).done(function(e){var t=e.data.items,i=[],a=[],d=[];$.each(t,function(e,t){i.push(t.log_temp),a.push(t.log_time),d.push(t.log_timestamp)}),graphRender(i.reverse(),a.reverse()),historyRender(t),$disconnect=$("#disconnect-bar");var s=e.data.device_log;$("body").removeClass("alert active disconnect disable"),"disable"===e.data.status?$("body").addClass("disable"):e.data.update-d[0]>disconnect_time?$("body").addClass("disconnect"):s.current.temp<device_min||s.current.temp>device_max?($("body").removeClass("active"),$("body").addClass("alert")):($("body").removeClass("alert"),$("body").addClass("active")),renderCurrent(e.data.device_log),setTimeout(function(){myChart.destroy(),init()},1e4)})}function renderCurrent(e){var t=($("#site_title").val(),$("#device_name").val());document.title=e.current.temp+"° | "+t,$("#tempcurrent").html(e.current.temp+"°"),$("#timecurrent").html(e.current.time),$("#templowest").html(e.min.temp+"°"),$("#timelowest").html(e.min.time),$("#temphighest").html(e.max.temp+"°"),$("#timehighest").html(e.max.time)}function graphRender(e,t){$("#graph").html("");var i=document.getElementById("graph").getContext("2d");myChart=new Chart(i,{type:"line",data:{labels:t,datasets:[{data:e,backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",borderWidth:4,pointBorderWidth:0,fill:!1,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(e){return e.yLabel}}},title:{display:!1},legend:{display:!1},scales:{yAxes:[{gridLines:{drawBorder:!1,display:!1},ticks:{stepSize:2},position:"right"}],xAxes:[{display:!1}]},animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0}})}function historyRender(e){var t="",i=new Array;return 0==e.length?($("#historylog").html('<div class="empty">ไม่มีข้อมูลอุปกรณ์นี้</div>'),!1):($.each(e,function(e,a){i.push(parseFloat(a.log_temp));var d="",s="";switch(a.alert&&(d="alert"),a.log_state){case"up":s='<i class="fa fa-arrow-up"></i>';break;case"down":s='<i class="fa fa-arrow-down"></i>'}t+='<div class="logitems '+d+'">',t+='<div class="time">'+a.log_time_fb+"</div>",t+='<div class="status"><i class="fas fa-circle"></i></div>',t+='<div class="icon">'+s+"</div>",t+='<div class="temp">'+a.log_temp+" °C</div>",t+="</div>"}),$("#historylog").html(t),void 0)}var time_lastupdate=0,loop_lost=0,device_min=0,device_max=0,device_od,myChart,limit=40,disconnect_time=300;Chart.defaults.global.defaultFontColor="#DDDDDD",Chart.defaults.global.defaultFontSize="10",$(document).ready(function(){device_min=parseInt($("#device_min").val()),device_max=parseInt($("#device_max").val()),device_id=$("#device_id").val(),tippy("[title]",{arrow:!0}),init()});