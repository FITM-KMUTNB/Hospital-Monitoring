function init(){$("#loading-bar").toggleClass("-action"),$.ajax({url:"api.php",cache:!1,dataType:"json",type:"GET",data:{calling:"log",action:"history_log",device_id:device_id,time_stamp:time_lastupdate,limit:limit},error:function(){$("#disconnect-bar").addClass("-active"),setTimeout(function(){myChart.destroy(),init()},1e4)}}).done(function(e){var t=e.data.items,i=[],a=[],n=[];$.each(t,function(e,t){i.push(t.log_temp),a.push(t.log_time),n.push(t.log_timestamp)}),deviceDisconnect(n[0],e.data.update),graphRender(i.reverse(),a.reverse()),historyRender(t),renderCurrent(e.data.device_log),setTimeout(function(){myChart.destroy(),init()},1e4)})}function deviceDisconnect(e,t){$disconnect=$("#disconnect-bar");var i=t-e;i>300?$disconnect.addClass("-active"):$disconnect.removeClass("-active")}function renderCurrent(e){var t=($("#site_title").val(),$("#device_name").val());document.title=e.current.temp+"°C | "+t,$("#tempcurrent").html(e.current.temp+"°"),$("#timecurrent").html(e.current.time),$("#templowest").html(e.min.temp+"°"),$("#timelowest").html(e.min.time),$("#temphighest").html(e.max.temp+"°"),$("#timehighest").html(e.max.time),e.max.temp>=device_max?$("#temphighest").addClass("over"):$("#temphighest").removeClass("over"),e.min.temp<=device_min?$("#templowest").addClass("over"):$("#templowest").removeClass("over")}function limitChecking(e){var t=e[e.length-1];if(t>=device_max||device_min>=t){var i=["#e74c3c","#451612"];return i}var i=["#2962FF","#ebf4f9"];return i}function graphRender(e,t){$("#graph").html("");var i=limitChecking(e),a=document.getElementById("graph").getContext("2d");myChart=new Chart(a,{type:"line",data:{labels:t,datasets:[{data:e,backgroundColor:i[0],borderColor:i[0],borderWidth:4,pointBorderWidth:0,fill:!1,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(e){return e.yLabel}}},title:{display:!1},legend:{display:!1},scales:{yAxes:[{gridLines:{drawBorder:!1,display:!1},ticks:{stepSize:2},position:"right"}],xAxes:[{display:!1}]},animation:{duration:0},hover:{animationDuration:0},responsiveAnimationDuration:0}})}function historyRender(e){var t="",i=new Array;return 0==e.length?($("#historylog").html('<div class="empty">ไม่มีข้อมูลอุปกรณ์นี้</div>'),!1):($.each(e,function(e,a){i.push(parseFloat(a.log_temp));var n="",r="";switch(a.alert&&(n="alert"),a.log_state){case"up":r='<i class="fa fa-arrow-up"></i>';break;case"down":r='<i class="fa fa-arrow-down"></i>'}t+='<div class="logitems '+n+'">',t+='<div class="status"><i class="fas fa-circle"></i></div>',t+='<div class="time">'+a.log_time_fb+"</div>",t+='<div class="temp">'+a.log_temp+" °C</div>",t+='<div class="icon">'+r+"</div>",t+="</div>"}),$("#historylog").html(t),void 0)}var time_lastupdate=0,loop_lost=0,device_min=0,device_max=0,device_od,myChart,limit=40,disconnect_time=240;Chart.defaults.global.defaultFontColor="#999999",Chart.defaults.global.defaultFontSize="10",$(document).ready(function(){device_min=parseInt($("#device_min").val()),device_max=parseInt($("#device_max").val()),device_id=$("#device_id").val(),tippy("[title]",{arrow:!0}),init()});